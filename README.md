# camera_system


–¢–≤—ñ–π –∫–æ–¥ —É–∂–µ –¥–æ—Å–∏—Ç—å —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π, –∞–ª–µ –¥–ª—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è —Ü—ñ–ª–µ–π:

–ó—Ä–æ–±–∏—Ç–∏ —Å—Ç—Ä—ñ–º –¥–æ—Å—Ç—É–ø–Ω–∏–º –∑ –±—É–¥—å-—è–∫–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é —á–µ—Ä–µ–∑ –±—É–¥—å-—è–∫–∏–π —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç.

–ó–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤—Å—ñ –≤—ñ–¥–µ–æ 24 –≥–æ–¥–∏–Ω–∏ —Ç–∞ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –ø–µ—Ä–µ–≥–ª—è–¥ –±—É–¥—å-—è–∫–æ–≥–æ –º–æ–º–µ–Ω—Ç—É.

–î–æ–¥–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–∫—Ä—ñ–Ω—à–æ—Ç—ñ–≤ —á–µ—Ä–µ–∑ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

–ü–æ—Ç—Ä—ñ–±–Ω–æ —Å—É—Ç—Ç—î–≤–æ —Ä–æ–∑—à–∏—Ä–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª. –û—Å—å –ø–æ–≤–Ω–∏–π –ø–ª–∞–Ω —ñ–∑ –ø–æ–µ—Ç–∞–ø–Ω–æ—é —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—î—é:

‚úÖ 1. –î–æ—Å—Ç—É–ø –¥–æ —Å—Ç—Ä—ñ–º—É –∑ –±—É–¥—å-—è–∫–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é
–¢–≤—ñ–π Flask-—Å–µ—Ä–≤–µ—Ä –ø—Ä–∞—Ü—é—î –Ω–∞ 0.0.0.0, —â–æ –¥–æ–∑–≤–æ–ª—è—î –¥–æ—Å—Ç—É–ø —É –ª–æ–∫–∞–ª—å–Ω—ñ–π –º–µ—Ä–µ–∂—ñ. –©–æ–± –ø—Ä–∞—Ü—é–≤–∞–ª–æ —á–µ—Ä–µ–∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç:

–í–∞—Ä–∏–∞–Ω—Ç–∏:
–í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ ngrok (–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ –¥–ª—è —Ç–µ—Å—Ç—ñ–≤)

–í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ VPS –∞–±–æ —Ö–æ—Å—Ç–∏–Ω–≥ —ñ–∑ –≤—ñ–¥–∫—Ä–∏—Ç–∏–º –ø–æ—Ä—Ç–æ–º

–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø–æ—Ä—Ç-—Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥ –Ω–∞ —Ä–æ—É—Ç–µ—Ä—ñ (–º–µ–Ω—à –±–µ–∑–ø–µ—á–Ω–æ)

–ü—Ä–∏–∫–ª–∞–¥ –∑ ngrok:
–í—Å—Ç–∞–Ω–æ–≤–∏ ngrok

–ó–∞–ø—É—Å—Ç–∏:

bash
Kopieren
Bearbeiten
ngrok http 5000
–û—Ç—Ä–∏–º–∞—î—à –ø—É–±–ª—ñ—á–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è, —è–∫–µ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±—É–¥—å-–¥–µ.

‚úÖ 2. –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Ä–æ–±–∏—Ç–∏ —Å–∫—Ä—ñ–Ω—à–æ—Ç–∏ —á–µ—Ä–µ–∑ –≤–µ–±
üîß –†—ñ—à–µ–Ω–Ω—è:
–î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –µ–Ω–¥–ø–æ—ñ–Ω—Ç /snapshot, —è–∫–∏–π —Ä–æ–±–∏—Ç–∏–º–µ —Å–∫—Ä—ñ–Ω—à–æ—Ç –∑ –∫–∞–º–µ—Ä–∏:

python
Kopieren
Bearbeiten
@app.route('/snapshot')
def take_snapshot():
    cap = cv2.VideoCapture(0)
    ret, frame = cap.read()
    cap.release()
    if ret:
        timestamp = int(time.time())
        snapshot_path = os.path.join(SNAPSHOT_FOLDER, f"snapshot_{timestamp}.jpg")
        cv2.imwrite(snapshot_path, frame)
        return f"–°–∫—Ä—ñ–Ω—à–æ—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–æ: {snapshot_path}"
    else:
        return "–ü–æ–º–∏–ª–∫–∞ –∑—á–∏—Ç—É–≤–∞–Ω–Ω—è –∫–∞–º–µ—Ä–∏", 500
‚úÖ 3. –ü–µ—Ä–µ–≥–ª—è–¥ –∞—Ä—Ö—ñ–≤—É –≤—ñ–¥–µ–æ –∑–∞ 24 –≥–æ–¥–∏–Ω–∏
–¢–≤—ñ–π –∫–æ–¥ —É–∂–µ –∑–±–µ—Ä—ñ–≥–∞—î –≤—ñ–¥–µ–æ. –î–æ–¥–∞–π –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É:

üîß HTML —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
python
Kopieren
Bearbeiten
from flask import send_from_directory, render_template_string

@app.route('/')
def index():
    files = sorted(os.listdir(VIDEO_FOLDER), reverse=True)
    file_list_html = "".join(f"<li><a href='/video/{file}'>{file}</a></li>" for file in files)
    return render_template_string("""
        <h1>–ó–∞–ø–∏—Å–∏ –≤—ñ–¥–µ–æ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 24 –≥–æ–¥–∏–Ω–∏</h1>
        <ul>{{ files|safe }}</ul>
        <br>
        <a href='/video_feed'>üé• –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å—Ç—Ä—ñ–º</a><br>
        <a href='/snapshot'>üì∏ –ó—Ä–æ–±–∏—Ç–∏ —Å–∫—Ä—ñ–Ω—à–æ—Ç</a>
    """, files=file_list_html)

@app.route('/video/<filename>')
def video(filename):
    return send_from_directory(VIDEO_FOLDER, filename)
‚úÖ 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤—ñ–¥–µ–æ —Å—Ç–∞—Ä—à–µ 24 –≥–æ–¥–∏–Ω
python
Kopieren
Bearbeiten
def clean_old_videos():
    now = time.time()
    for filename in os.listdir(VIDEO_FOLDER):
        path = os.path.join(VIDEO_FOLDER, filename)
        if os.stat(path).st_mtime < now - 24 * 3600:
            os.remove(path)
–î–æ–¥–∞–π –≤–∏–∫–ª–∏–∫ —Ü—ñ—î—ó —Ñ—É–Ω–∫—Ü—ñ—ó —â–æ–≥–æ–¥–∏–Ω–∏ –∞–±–æ –ø–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º –∑–∞–ø–∏—Å—É:

python
Kopieren
Bearbeiten
clean_old_videos()
‚úÖ 5. –û–Ω–æ–≤–ª–µ–Ω–∏–π main –∑–∞–ø—É—Å–∫
python
Kopieren
Bearbeiten
if __name__ == '__main__':
    dim_screen()
    while True:
        if internet_on():
            print("[INFO] –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç —î ‚Äî –∑–∞–ø—É—Å–∫–∞—î–º–æ —Å—Ç—Ä—ñ–º...")
            flask_thread = threading.Thread(target=run_flask)
            flask_thread.daemon = True
            flask_thread.start()
            flask_thread.join()
        else:
            print("[INFO] –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—É –Ω–µ–º–∞—î ‚Äî –¥–µ—Ç–µ–∫—Ü—ñ—è —Ä—É—Ö—É —ñ –ª–æ–∫–∞–ª—å–Ω–∏–π –∑–∞–ø–∏—Å...")
            clean_old_videos()
            detect_motion_and_record()
üìå –ë–µ–∑–ø–µ–∫–∞:
–ù—ñ–∫–æ–ª–∏ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞–π email-–ø–∞—Ä–æ–ª—ñ –≤ –∫–æ–¥—ñ! –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –∞–±–æ .env.

–ó–∞—Ö–∏—Å—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É —á–µ—Ä–µ–∑ –ø–∞—Ä–æ–ª—å –∞–±–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é, —è–∫—â–æ —Å—Ç—Ä—ñ–º –¥–æ—Å—Ç—É–ø–Ω–∏–π –ø—É–±–ª—ñ—á–Ω–æ.
